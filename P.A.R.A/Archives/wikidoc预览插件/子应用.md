# 乾坤加载umi子应用资源文件加载失败问题
问题描述：主应用使用乾坤加载umi打包出来的多页子应用，通过umi的config.plugin 打包的子应用，图片加载失败，香项目默认的资源文件打包后加载正常。在build后的产物中，项目默认的资源文件的A.html中包含<script>window.routerBase = '/demo-center'</script><script>window.publicPath = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ || './'</script>，通过umi的config.plugin打包的子应用B没有这部分代码。即使在public 的B.html中手动加上 script 部分的代码，在主应用中加载后仍然有问题。

分析：dom中加载失败的资源文件路径为相对路径，资源路径不正确，导致加载失败。

求助cursor: 
前提：umirc配置文件和图片加载组件
问题：请解释图片资源文件是如何加载的，并解释为什么当前文件配置打包出来的index.html子应用图片资源文件路径为正确的资源文件路径（https://ip/demo/static/xx.svg），而通过config.plugin()打包出来的子应用preview.html子应用图片资源路径为（./static/xx.svg），期望主应用加载的插件能正常显示资源文件

入口文件增加 webpack 配置脚本，增加 publicPath 处理。

```
// 新增文件public-path.ts
if (window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__) {
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
} else {
  __webpack_public_path__ = '/absolute-path/';
}

// 在插件入口文件顶部导入
import './public-path.ts'
...

// 在HTML模板文件增加脚本
<script>
  window.publicPath = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
</script>
<script>
  window.routerBase = "/apply-router";
</script>
```

1. HTML 中增加的脚本作用：
- 在页面加载时立即执行
- 设置一个全局变量 window.publicPath
- 主要用于运行时动态获取资源路径
- 供 Javascript 运行时使用，比如动态加载资源时可以使用这个路径

2. 入口文件中导入的 public-path.ts 脚本的作用:
- 在 webpack 编译时期生效
- 设置 webpack 的 __webpack_public_path__ 变量
- 影响所有通过 webpack 打包的资源的基础路径
- 主要用于编译时的资源路径解析

关键区别：
1. 执行时机不同：
  - HTML 脚本在页面加载时执行
  - public-path.ts 在 webpack 编译和模块加载时执行
2. 作用范围不同：
  - HTML 脚本设置的是运行时的全局变量
  - public-path.ts 设置的是 webpack 的资源加载路径
3. 使用场景不同：
  - HTML 中的publicPath 主要用于运行时动态加载资源
  - webpack 的 publicPath 用于静态资源（如图片、css、JS等）的编译时路径解析
